@page "/"
@inject NavigationManager Navigation

<div class="background-grad p-5 m-5 text-center">
    <h2>Welcome, Service Member!</h2>
    <h4> Transition Assistance Program Checklist</h4>

    <p class="mt-3">Easy way to track requiments to transition out of the Service</p>
    <hr />

    <!-- Date Input for Service End Date -->
    <div class="form-group mt-4">
        <label for="endDate" class="form-label"><strong>Enter Your ETS Date:</strong></label>
        <input type="date" id="endDate" class="form-control date-input" @bind="EndDate" />
    </div>

    <!-- Countdown Display -->
    @if (monthsRemaining > 0 || daysRemaining > 0)
    {
        <div class="mt-4 countdown">
            <h3>Countdown to ETS</h3>
            <h1>@monthsRemaining months and @daysRemaining days</h1>
        </div>
    }
    else if (monthsRemaining == 0 && daysRemaining == 0 && endDate != null)
    {
        <div class="mt-4 countdown">
            <h3>Today is your End of Service Date!</h3>
        </div>
    }
    else
    {
        <div class="mt-4 countdown">
            <h3>Your End of Service Date has passed.</h3>
        </div>
    }

    <!-- Link to the To-Do List Page -->
    <button class="btn btn-primary mt-4" @onclick="NavigateToTodoList">Proceed to To-Do List</button>
</div>

<style>
    .background-grad {
        background-color: #4E73DF;
        background-image: linear-gradient(160deg, #4E73DF 0%, #1CC88A 100%);
        color: white;
        padding: 2rem;
        border-radius: 10px;
    }

    .countdown h1 {
        font-size: 3rem;
        color: #FFD700;
    }

    .date-input {
        width: 50%;
        margin: 0 auto;
        padding: 0.5rem;
    }

    .btn-primary {
        background-color: #1CC88A;
        border: none;
    }

        .btn-primary:hover {
            background-color: #17A673;
        }
</style>

@code {
    private DateTime? endDate;
    private int monthsRemaining = 0;
    private int daysRemaining = 0;

    private DateTime? EndDate
    {
        get => endDate;
        set
        {
            endDate = value;
            CalculateTimeRemaining();
        }
    }

    private void CalculateTimeRemaining()
    {
        if (endDate.HasValue)
        {
            var today = DateTime.Today;
            var targetDate = endDate.Value.Date;

            if (targetDate > today)
            {
                var totalDays = (targetDate - today).Days;

                monthsRemaining = totalDays / 30;  // Approximate months (30 days each)
                daysRemaining = totalDays % 30;    // Remaining days after full months
            }
            else
            {
                monthsRemaining = 0;
                daysRemaining = 0;
            }
        }
    }

    private void NavigateToTodoList()
    {
        Navigation.NavigateTo("/todolist");
    }
}
